(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5137],{32453:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var n=s(37876),a=s(49380);let r=e=>{let{bottles:t,isConnected:s,isLoading:a,onBottleClick:r}=e;return a?(0,n.jsx)("p",{className:"text-center py-12 text-gray-500",children:"読み込み中..."}):s?0===t.length?(0,n.jsx)("p",{className:"text-center py-12 text-gray-500",children:"まだ小瓶を拾っていません"}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg cursor-pointer",onClick:()=>r(e),children:[(0,n.jsx)("div",{className:"aspect-w-16 aspect-h-9",children:(0,n.jsx)("img",{src:e.image||"".concat("/Echoes_in_the_Tide","/bottle.webp"),alt:"小瓶",className:"w-full h-48 object-cover"})}),(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("p",{className:"text-gray-700 mb-2 line-clamp-3",children:e.description}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp})]})]},e.id))}):(0,n.jsx)("p",{className:"text-center py-12 text-gray-500",children:"ウォレットを接続してください"})};var l=s(94529),i=s(14232),o=s(73845),c=s(8047);let d=()=>{let{userBottles:e,isLoading:t,error:s,fetchUserBottles:n}=(0,o.$)(),{isConnected:a,address:r}=(0,c.F)(),[l,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{a&&r&&n(r)},[a,r,n]),{isConnected:a,isLoading:t,error:s,bottles:e,selectedBottle:l,setSelectedBottle:d}},m=e=>{let{message:t}=e;return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,n.jsx)(a.F,{}),(0,n.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsx)("p",{className:"text-red-500 text-center",children:t})})})]})};function x(){let{isConnected:e,isLoading:t,error:s,bottles:i,selectedBottle:o,setSelectedBottle:c}=d();return s?(0,n.jsx)(m,{message:s.message}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,n.jsx)(a.A,{}),(0,n.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"拾った小瓶"}),(0,n.jsx)(r,{bottles:i,isConnected:e,isLoading:t,onBottleClick:c}),o&&(0,n.jsx)(l.A,{bottle:o,onClose:()=>c(null),showClaimButton:!1})]})]})}},49380:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,F:()=>c});var n=s(37876),a=s(14232),r=s(48230),l=s.n(r),i=s(18847);let o=s.n(i)()(()=>s.e(2287).then(s.bind(s,92287)),{loadableGenerated:{webpack:()=>[92287]},ssr:!1}),c=()=>{let[e,t]=(0,a.useState)(!1);return(0,n.jsxs)("nav",{className:"bg-white shadow-lg",children:[(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,n.jsxs)("div",{className:"flex justify-between h-16",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)(l(),{href:"/",className:"flex items-center",children:(0,n.jsx)("span",{className:"text-xl font-bold",children:"波打ち際の小瓶"})})}),(0,n.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,n.jsx)(l(),{href:"/",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"海を眺める"}),(0,n.jsx)(l(),{href:"/throw",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,n.jsx)(l(),{href:"/mybottles",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,n.jsx)(l(),{href:"/setting",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"設定"}),(0,n.jsx)(o,{})]}),(0,n.jsx)("div",{className:"md:hidden flex items-center",children:(0,n.jsxs)("button",{onClick:()=>t(!e),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:[(0,n.jsx)("span",{className:"sr-only",children:"メニューを開く"}),e?(0,n.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,n.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]})})]})}),e&&(0,n.jsx)("div",{className:"md:hidden",children:(0,n.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[(0,n.jsx)(l(),{href:"/",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"海を眺める"}),(0,n.jsx)(l(),{href:"/throw",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,n.jsx)(l(),{href:"/mybottles",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,n.jsx)(l(),{href:"/setting",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"設定"}),(0,n.jsx)("div",{className:"px-3 py-2",children:(0,n.jsx)(o,{})})]})})]})},d=c},50477:()=>{},64996:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/mybottles",function(){return s(32453)}])},73845:(e,t,s)=>{"use strict";s.d(t,{$:()=>g});var n,a=s(8106),r=s(4319),l=s(59688),i=s(30896),o=s.n(i);let c=(0,a.v)()((0,r.Zr)((e,t)=>({encryptedData:null,sessionApiKey:null,loadConfig:async(s,n)=>{let a=t().sessionApiKey;if(a)return{apiKey:a};try{let s=t().encryptedData;if(!s||s.address.toLowerCase()!==n.address.toLowerCase())return null;let a=o().SHA256(s.signature).toString(),r=o().AES.decrypt(s.ciphertext,a).toString(o().enc.Utf8);if(!r)return null;let l=JSON.parse(r);return e({sessionApiKey:l.apiKey}),l}catch(e){return console.error("設定の読み込みに失敗しました:",e),null}},encryptAndStoreConfig:async(t,s,n)=>{try{let a=JSON.stringify(t),r=await s.signMessage({account:n,message:"Encrypt filebase config"}),i=o().SHA256(r).toString(),c={ciphertext:o().AES.encrypt(a,i).toString(),signature:r,address:n.address};e({encryptedData:c,sessionApiKey:t.apiKey}),l.oR.success("設定を保存しました")}catch(e){throw console.error("設定の暗号化に失敗しました:",e),l.oR.error("設定の保存に失敗しました"),e}},clearConfig:()=>{e({encryptedData:null,sessionApiKey:null}),l.oR.success("設定を削除しました")}}),{name:"encrypted-filebase-storage",storage:(0,r.KU)(()=>localStorage),partialize:e=>({encryptedData:e.encryptedData,sessionApiKey:e.sessionApiKey})}));var d=s(91040);let m=null!=(n=s(65364).env.NEXT_PUBLIC_SUBGRAPH_URL)?n:"https://api.studio.thegraph.com/query/109981/ocean/version/latest";function x(e){return null==e?void 0:e.replace(/^ipfs:\/\//,"https://ipfs.io/ipfs/")}async function h(e){let t=x(e);if(!t)return{};try{let{name:e,description:s,message:n,image:a,animation_url:r}=(await d.A.get(t)).data;return{name:e,description:s,message:n,image:x(a),html:x(r)}}catch(e){return{}}}async function u(e){var t,s,n;let a=null!=(n=null==(s=(await d.A.post(m,{query:"{\n  driftingBottles {\n    id\n    tokenURI\n    sender\n  }\n}"})).data)||null==(t=s.data)?void 0:t.driftingBottles)?n:[];return e&&(a=a.filter(t=>{var s;return(null==(s=t.sender)?void 0:s.toLowerCase())!==e.toLowerCase()})),Promise.all(a.sort(()=>.5-Math.random()).slice(0,3).map(async e=>{var t;return{...e,metadata_url:x(e.tokenURI),...await h(null!=(t=e.tokenURI)?t:"")}}))}async function p(e){var t,s;let n='\n    query {\n      bottleClaimeds(where: { claimer: "'.concat(e.toLowerCase(),'" }) {\n        tokenId\n        blockTimestamp\n      }\n      bottleMinteds {\n        tokenId\n        tokenURI\n      }\n    }'),{bottleClaimeds:a,bottleMinteds:r}=null!=(s=null==(t=(await d.A.post(m,{query:n})).data)?void 0:t.data)?s:{bottleClaimeds:[],bottleMinteds:[]};return Promise.all(a.map(async e=>{let t=r.find(t=>t.tokenId===e.tokenId);if(!t)return null;let s=await h(t.tokenURI);return{id:e.tokenId,tokenId:e.tokenId,tokenURI:t.tokenURI,...s,date:new Date(1e3*parseInt(e.blockTimestamp)).toLocaleDateString("ja-JP"),status:"所有中",timestamp:new Date(1e3*parseInt(e.blockTimestamp)).toLocaleString("ja-JP")}})).then(e=>e.filter(e=>!!e))}let g=(0,a.v)()((0,r.Zr)((e,t)=>({bottles:[],userBottles:[],filebaseConfig:null,isLoading:!1,error:null,lastFetched:null,fetchBottles:async t=>{e({isLoading:!0,error:null});try{let s=await u(t);e({bottles:s,lastFetched:Date.now(),isLoading:!1})}catch(t){e({error:t,isLoading:!1})}},fetchUserBottles:async t=>{if(!t)return void e({error:Error("ウォレットが接続されていません")});e({isLoading:!0,error:null});try{let s=await p(t);e({userBottles:s,isLoading:!1})}catch(t){e({error:t,isLoading:!1})}},getBottleById:e=>t().bottles.find(t=>t.id===e),setConfig:t=>e({filebaseConfig:t}),loadConfig:async(t,s)=>{try{let n=await c.getState().loadConfig(t,s);e({filebaseConfig:n})}catch(t){e({filebaseConfig:null})}},saveConfig:async(t,s,n)=>{await c.getState().encryptAndStoreConfig(n,t,s),e({filebaseConfig:n})},clearConfig:()=>{c.getState().clearConfig(),e({filebaseConfig:null})}}),{name:"bottle-store"}))},94529:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(37876);function a(e){let{bottle:t,onClose:s,showClaimButton:a=!1,onClaim:r}=e;return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-[2px] flex items-center justify-center p-4 z-50",onClick:e=>{e.target===e.currentTarget&&s()},children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-xl",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"小瓶の中身"}),(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:t.description}),t.image?(0,n.jsx)("img",{src:t.image,alt:"小瓶の中身",className:"w-full h-48 object-contain rounded-lg"}):(0,n.jsx)("img",{src:"".concat("/Echoes_in_the_Tide","/bottle.webp"),alt:"小瓶の中身",className:"w-full h-48 object-contain rounded-lg"}),(0,n.jsx)("div",{className:"mt-4 flex flex-col gap-2",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[t.timestamp&&(0,n.jsx)("p",{className:"text-sm text-gray-500",children:t.timestamp}),a&&(0,n.jsx)("button",{onClick:()=>r&&r(t),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200",children:"小瓶を拾う"}),(0,n.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200",children:"閉じる"})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[9237,636,6593,8792],()=>t(64996)),_N_E=e.O()}]);