(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7044],{33948:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/setting",function(){return s(79691)}])},49380:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,F:()=>d});var r=s(37876),n=s(14232),a=s(48230),l=s.n(a),i=s(18847);let o=s.n(i)()(()=>s.e(2287).then(s.bind(s,92287)),{loadableGenerated:{webpack:()=>[92287]},ssr:!1}),d=()=>{let[e,t]=(0,n.useState)(!1);return(0,r.jsxs)("nav",{className:"bg-white shadow-lg",children:[(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)(l(),{href:"/",className:"flex items-center",children:(0,r.jsx)("span",{className:"text-xl font-bold",children:"波打ち際の小瓶"})})}),(0,r.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,r.jsx)(l(),{href:"/",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"海を眺める"}),(0,r.jsx)(l(),{href:"/throw",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,r.jsx)(l(),{href:"/mybottles",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,r.jsx)(l(),{href:"/setting",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"設定"}),(0,r.jsx)(o,{})]}),(0,r.jsx)("div",{className:"md:hidden flex items-center",children:(0,r.jsxs)("button",{onClick:()=>t(!e),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:[(0,r.jsx)("span",{className:"sr-only",children:"メニューを開く"}),e?(0,r.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,r.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]})})]})}),e&&(0,r.jsx)("div",{className:"md:hidden",children:(0,r.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[(0,r.jsx)(l(),{href:"/",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"海を眺める"}),(0,r.jsx)(l(),{href:"/throw",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,r.jsx)(l(),{href:"/mybottles",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,r.jsx)(l(),{href:"/setting",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"設定"}),(0,r.jsx)("div",{className:"px-3 py-2",children:(0,r.jsx)(o,{})})]})})]})},c=d},50477:()=>{},73845:(e,t,s)=>{"use strict";s.d(t,{$:()=>y});var r,n=s(8106),a=s(4319),l=s(59688),i=s(30896),o=s.n(i);let d=(0,n.v)()((0,a.Zr)((e,t)=>({encryptedData:null,sessionApiKey:null,loadConfig:async(s,r)=>{let n=t().sessionApiKey;if(n)return{apiKey:n};try{let s=t().encryptedData;if(!s||s.address.toLowerCase()!==r.address.toLowerCase())return null;let n=o().SHA256(s.signature).toString(),a=o().AES.decrypt(s.ciphertext,n).toString(o().enc.Utf8);if(!a)return null;let l=JSON.parse(a);return e({sessionApiKey:l.apiKey}),l}catch(e){return console.error("設定の読み込みに失敗しました:",e),null}},encryptAndStoreConfig:async(t,s,r)=>{try{let n=JSON.stringify(t),a=await s.signMessage({account:r,message:"Encrypt filebase config"}),i=o().SHA256(a).toString(),d={ciphertext:o().AES.encrypt(n,i).toString(),signature:a,address:r.address};e({encryptedData:d,sessionApiKey:t.apiKey}),l.oR.success("設定を保存しました")}catch(e){throw console.error("設定の暗号化に失敗しました:",e),l.oR.error("設定の保存に失敗しました"),e}},clearConfig:()=>{e({encryptedData:null,sessionApiKey:null}),l.oR.success("設定を削除しました")}}),{name:"encrypted-filebase-storage",storage:(0,a.KU)(()=>localStorage),partialize:e=>({encryptedData:e.encryptedData,sessionApiKey:e.sessionApiKey})}));var c=s(91040);let m=null!=(r=s(65364).env.NEXT_PUBLIC_SUBGRAPH_URL)?r:"https://api.studio.thegraph.com/query/109981/ocean/version/latest";function u(e){return null==e?void 0:e.replace(/^ipfs:\/\//,"https://ipfs.io/ipfs/")}async function h(e){let t=u(e);if(!t)return{};try{let{name:e,description:s,message:r,image:n,animation_url:a}=(await c.A.get(t)).data;return{name:e,description:s,message:r,image:u(n),html:u(a)}}catch(e){return{}}}async function x(e){var t,s,r;let n=null!=(r=null==(s=(await c.A.post(m,{query:"{\n  driftingBottles {\n    id\n    tokenURI\n    sender\n  }\n}"})).data)||null==(t=s.data)?void 0:t.driftingBottles)?r:[];return e&&(n=n.filter(t=>{var s;return(null==(s=t.sender)?void 0:s.toLowerCase())!==e.toLowerCase()})),Promise.all(n.sort(()=>.5-Math.random()).slice(0,3).map(async e=>{var t;return{...e,metadata_url:u(e.tokenURI),...await h(null!=(t=e.tokenURI)?t:"")}}))}async function p(e){var t,s;let r='\n    query {\n      bottleClaimeds(where: { claimer: "'.concat(e.toLowerCase(),'" }) {\n        tokenId\n        blockTimestamp\n      }\n      bottleMinteds {\n        tokenId\n        tokenURI\n      }\n    }'),{bottleClaimeds:n,bottleMinteds:a}=null!=(s=null==(t=(await c.A.post(m,{query:r})).data)?void 0:t.data)?s:{bottleClaimeds:[],bottleMinteds:[]};return Promise.all(n.map(async e=>{let t=a.find(t=>t.tokenId===e.tokenId);if(!t)return null;let s=await h(t.tokenURI);return{id:e.tokenId,tokenId:e.tokenId,tokenURI:t.tokenURI,...s,date:new Date(1e3*parseInt(e.blockTimestamp)).toLocaleDateString("ja-JP"),status:"所有中",timestamp:new Date(1e3*parseInt(e.blockTimestamp)).toLocaleString("ja-JP")}})).then(e=>e.filter(e=>!!e))}let y=(0,n.v)()((0,a.Zr)((e,t)=>({bottles:[],userBottles:[],filebaseConfig:null,isLoading:!1,error:null,lastFetched:null,fetchBottles:async t=>{e({isLoading:!0,error:null});try{let s=await x(t);e({bottles:s,lastFetched:Date.now(),isLoading:!1})}catch(t){e({error:t,isLoading:!1})}},fetchUserBottles:async t=>{if(!t)return void e({error:Error("ウォレットが接続されていません")});e({isLoading:!0,error:null});try{let s=await p(t);e({userBottles:s,isLoading:!1})}catch(t){e({error:t,isLoading:!1})}},getBottleById:e=>t().bottles.find(t=>t.id===e),setConfig:t=>e({filebaseConfig:t}),loadConfig:async(t,s)=>{try{let r=await d.getState().loadConfig(t,s);e({filebaseConfig:r})}catch(t){e({filebaseConfig:null})}},saveConfig:async(t,s,r)=>{await d.getState().encryptAndStoreConfig(r,t,s),e({filebaseConfig:r})},clearConfig:()=>{d.getState().clearConfig(),e({filebaseConfig:null})}}),{name:"bottle-store"}))},79691:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(37876),n=s(49380),a=s(14232),l=s(73845),i=s(59688),o=s(8047),d=s(80653);let c=()=>{let{filebaseConfig:e,loadConfig:t,saveConfig:s,clearConfig:r}=(0,l.$)(),[n,c]=(0,a.useState)(""),[m,u]=(0,a.useState)(!1),[h,x]=(0,a.useState)(!0),{isConnected:p}=(0,o.F)(),{data:y}=(0,d.G)();(0,a.useEffect)(()=>{(async()=>{if(p&&(null==y?void 0:y.account))try{await t(y,y.account)}catch(e){console.error(e),i.oR.error("設定の読み込みに失敗しました")}x(!1)})()},[p,y]),(0,a.useEffect)(()=>{(null==e?void 0:e.apiKey)&&c(e.apiKey)},[e]);let f=async e=>{if(e.preventDefault(),!p||!(null==y?void 0:y.account))return void i.oR.error("ウォレットを接続してください");if(!n.trim())return void i.oR.error("APIキーを入力してください");u(!0);try{await s(y,y.account,{apiKey:n.trim()}),i.oR.success("設定を保存しました")}catch(e){console.error(e),i.oR.error("設定の保存に失敗しました")}finally{u(!1)}},g=async()=>{if(!p||!(null==y?void 0:y.account))return void i.oR.error("ウォレットを接続してください");try{r(),c(""),i.oR.success("設定を削除しました")}catch(e){console.error(e),i.oR.error("設定の削除に失敗しました")}};return{apiKey:n,isConnected:p,isLoading:h,isSaving:m,handleChange:e=>{c(e.target.value)},handleSubmit:f,handleClear:g}};function m(){let{isLoading:e,isConnected:t,apiKey:s,isSaving:n,handleChange:a,handleSubmit:l,handleClear:i}=c();return e?(0,r.jsx)("p",{className:"text-center py-4 text-gray-600",children:"読み込み中..."}):t?(0,r.jsxs)("form",{onSubmit:l,className:"bg-white rounded-lg shadow-md p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"filebaseApiKey",className:"block text-sm font-medium text-gray-700 mb-2",children:"Filebase IPFS RPC API Key"}),(0,r.jsx)("input",{type:"password",id:"filebaseApiKey",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",placeholder:"API Keyを入力してください",value:s,onChange:a,disabled:n}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"FilebaseのAPI Keyを設定すると、画像アップロードが可能になります。設定は暗号化されて保存されます。"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:i,disabled:n,className:"btn-red",children:"設定を削除"}),(0,r.jsx)("button",{type:"submit",disabled:n,className:"btn-blue",children:n?"保存中...":"保存"})]})]}):(0,r.jsx)("p",{className:"text-center py-4 text-gray-600",children:"設定を保存するにはウォレットを接続してください"})}function u(){return(0,r.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-md p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"アプリケーション情報"}),(0,r.jsxs)("dl",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"バージョン"}),(0,r.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:"1.0.0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"ネットワーク"}),(0,r.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:"Polygon Amoy Testnet"})]})]})]})}function h(){return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"設定"}),(0,r.jsx)(m,{}),(0,r.jsx)(u,{})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[9237,653,636,6593,8792],()=>t(33948)),_N_E=e.O()}]);