(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6411],{1916:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Q});var a=r(37876),n=r(49380),o=r(14232),l=r(59688);let c=e=>{let{image:t,previewUrl:r,filebaseConfig:n,isLoading:o,onImageChange:l}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"画像アップロード（任意）"}),!n&&(0,a.jsx)("p",{className:"text-red-600 mb-2 text-sm",children:"Filebase設定がありません。画像アップロードはできません。"}),(0,a.jsx)("input",{type:"file",accept:"image/*",disabled:o||!n,onChange:e=>{if(!n){alert("画像アップロードにはFilebaseの設定が必要です。"),e.target.value="";return}e.target.files&&e.target.files.length>0?l(e.target.files[0]):l(null)},className:"mb-2"}),r&&(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("img",{src:r,alt:"preview",className:"w-32 h-32 object-cover rounded-md"}),(0,a.jsx)("button",{type:"button",onClick:()=>{l(null)},disabled:o,className:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:"\xd7"})]})]})};var s=r(8494),i=r(60573),d=r(88630);let u=()=>{let e={address:i.L,abi:i.M},{writeContract:t,isPending:r,error:a}=(0,s.x)({mutation:{onSuccess:()=>{l.oR.success("小瓶を流しました！")},onError:e=>{l.oR.error("小瓶を流すのに失敗しました"),console.error(e)}}});return{throwBottle:(0,o.useCallback)(r=>{(0,d.T)(t,e,r)},[t]),isLoading:r,error:a}},f="https://rpc.filebase.io/api/v0",h=e=>"Bearer ".concat(e.apiKey),b=async(e,t)=>{try{let r=new FormData;r.append("file",e);let a=await fetch("".concat(f,"/add"),{method:"POST",headers:{Authorization:h(t)},body:r});if(!a.ok)throw Error("Filebaseへのアップロードに失敗しました");let n=await a.json();return"ipfs://".concat(n.Hash)}catch(e){throw l.oR.error("画像のアップロードに失敗しました"),e}},m=async(e,t)=>{try{let r=new Blob([JSON.stringify(e)],{type:"application/json"}),a=new File([r],"0.json",{type:"application/json"}),n=new FormData;n.append("file",a);let o=await fetch("".concat(f,"/add"),{method:"POST",headers:{Authorization:h(t)},body:n});if(!o.ok)throw Error("メタデータのアップロードに失敗しました");let l=await o.json();return console.log("メタデータのアップロードに成功しました",l),"ipfs://".concat(l.Hash)}catch(e){throw l.oR.error("メタデータのアップロードに失敗しました"),e}};var p=r(73845),x=r(8047),g=r(18462),y=r(82909).Buffer;let w="function"==typeof y,A="function"==typeof TextDecoder?new TextDecoder:void 0,v="function"==typeof TextEncoder?new TextEncoder:void 0,j=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),C=(e=>{let t={};return e.forEach((e,r)=>t[e]=r),t})(j),F=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,N=String.fromCharCode.bind(String),E="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),S=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),T=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),_="function"==typeof btoa?e=>btoa(e):w?e=>y.from(e,"binary").toString("base64"):e=>{let t,r,a,n,o="",l=e.length%3;for(let l=0;l<e.length;){if((r=e.charCodeAt(l++))>255||(a=e.charCodeAt(l++))>255||(n=e.charCodeAt(l++))>255)throw TypeError("invalid character found");o+=j[(t=r<<16|a<<8|n)>>18&63]+j[t>>12&63]+j[t>>6&63]+j[63&t]}return l?o.slice(0,l-3)+"===".substring(l):o},k=w?e=>y.from(e).toString("base64"):e=>{let t=[];for(let r=0,a=e.length;r<a;r+=4096)t.push(N.apply(null,e.subarray(r,r+4096)));return _(t.join(""))},U=(e,t=!1)=>t?S(k(e)):k(e),D=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?N(192|t>>>6)+N(128|63&t):N(224|t>>>12&15)+N(128|t>>>6&63)+N(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return N(240|t>>>18&7)+N(128|t>>>12&63)+N(128|t>>>6&63)+N(128|63&t)},B=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,O=e=>e.replace(B,D),R=w?e=>y.from(e,"utf8").toString("base64"):v?e=>k(v.encode(e)):e=>_(O(e)),z=(e,t=!1)=>t?S(R(e)):R(e),L=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,P=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return N((t>>>10)+55296)+N((1023&t)+56320);case 3:return N((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return N((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Z=e=>e.replace(L,P),H="function"==typeof atob?e=>atob(T(e)):w?e=>y.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!F.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r="",a,n;for(let o=0;o<e.length;)t=C[e.charAt(o++)]<<18|C[e.charAt(o++)]<<12|(a=C[e.charAt(o++)])<<6|(n=C[e.charAt(o++)]),r+=64===a?N(t>>16&255):64===n?N(t>>16&255,t>>8&255):N(t>>16&255,t>>8&255,255&t);return r},J=w?e=>E(y.from(e,"base64")):e=>E(H(e).split("").map(e=>e.charCodeAt(0))),K=e=>J(I(e)),X=w?e=>y.from(e,"base64").toString("utf8"):A?e=>A.decode(J(e)):e=>Z(H(e)),I=e=>T(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),M=e=>X(I(e)),$=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),q={fromUint8Array:U},G=()=>{let[e,t]=(0,o.useState)(""),[r,n]=(0,o.useState)(null),[s,i]=(0,o.useState)(null),[d,f]=(0,o.useState)(!1),[h,y]=(0,o.useState)(!1),{isConnected:w,address:A,connector:v}=(0,x.F)(),{connect:j,connectors:C}=(0,g.e)(),F=null==v?void 0:v.walletClient,N=A?{address:A}:void 0,{filebaseConfig:E,loadConfig:S}=(0,p.$)(),{throwBottle:T,isLoading:_}=u();(0,o.useEffect)(()=>{w&&h&&F&&N&&(async()=>{await S(F,N),k(),y(!1)})()},[w,h,F,N,S]);let k=async()=>{if(!E&&r)return void l.oR.error("画像をアップロードするにはFilebaseの設定が必要です");try{f(!0);let a=null,o={name:"Echoes in the Tide",description:e,image:""};if(E){if(r){let e=await b(r,E);o.image=null!=e?e:""}a=await m(o,E)}else{let e=JSON.stringify(o),t=new TextEncoder().encode(e),r=q.fromUint8Array(t);a="data:application/json;base64,".concat(r)}T&&(await T(null!=a?a:""),t(""),n(null),i(null))}catch(e){console.error(e),l.oR.error("送信に失敗しました")}finally{f(!1)}},U=async e=>{if(e.preventDefault(),!w){C[0]&&(y(!0),j({connector:C[0]}));return}await S(F,N),await k()};return(0,a.jsxs)("form",{onSubmit:U,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ"}),(0,a.jsx)("textarea",{id:"message",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"海に流すメッセージを入力してください...",value:e,onChange:e=>t(e.target.value),disabled:_||d})]}),(0,a.jsx)(c,{image:r,previewUrl:s,filebaseConfig:E,isLoading:_||d,onImageChange:e=>{n(e),e?i(URL.createObjectURL(e)):i(null)}}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("button",{type:"submit",className:"px-6 py-3 bg-blue-500 text-white font-medium rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",disabled:_||d,children:"送信"})})]})};function Q(){return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"小瓶を流す"}),(0,a.jsx)(G,{})]})})]})}},12524:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/throw",function(){return r(1916)}])},18462:(e,t,r)=>{"use strict";r.d(t,{e:()=>u});var a=r(40097),n=r(21395),o=r(14232),l=r(61511),c=r(44330),s=r(26949);let i=[];function d(e){let t=e.connectors;return(0,s.b)(i,t)?i:(i=t,t)}function u(e={}){let{mutation:t}=e,r=(0,l.U)(e),s={mutationFn:e=>(0,n.N)(r,e),mutationKey:["connect"]},{mutate:i,mutateAsync:f,...h}=(0,a.n)({...t,...s});return(0,o.useEffect)(()=>r.subscribe(({status:e})=>e,(e,t)=>{"connected"===t&&"disconnected"===e&&h.reset()}),[r,h.reset]),{...h,connect:i,connectAsync:f,connectors:function(e={}){let t=(0,l.U)(e);return(0,o.useSyncExternalStore)(e=>(0,c.O)(t,{onChange:e}),()=>d(t),()=>d(t))}({config:r})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[9237,8007,636,6593,8792],()=>t(12524)),_N_E=e.O()}]);