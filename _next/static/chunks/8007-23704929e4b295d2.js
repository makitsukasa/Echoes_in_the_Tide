(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8007],{8494:(t,e,s)=>{"use strict";s.d(e,{x:()=>a});var n=s(40097),r=s(1160),i=s(61511);function a(t={}){var e;let{mutation:s}=t,o=(e=(0,i.U)(t),{mutationFn:t=>(0,r.E)(e,t),mutationKey:["writeContract"]}),{mutate:l,mutateAsync:u,...c}=(0,n.n)({...s,...o});return{...c,writeContract:l,writeContractAsync:u}}},40097:(t,e,s)=>{"use strict";s.d(e,{n:()=>c});var n=s(14232),r=s(21407),i=s(60388),a=s(90089),o=s(37149),l=class extends a.Q{#t;#e=void 0;#s;#n;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.f8)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.EN)(e.mutationKey)!==(0,o.EN)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(t){this.#r(),this.#i(t)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#r(),this.#i()}mutate(t,e){return this.#n=e,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(t)}#r(){let t=this.#s?.state??(0,r.$)();this.#e={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#i(t){i.jG.batch(()=>{if(this.#n&&this.hasListeners()){let e=this.#e.variables,s=this.#e.context;t?.type==="success"?(this.#n.onSuccess?.(t.data,e,s),this.#n.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#n.onError?.(t.error,e,s),this.#n.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(t=>{t(this.#e)})})}},u=s(67768);function c(t,e){let s=(0,u.jE)(e),[r]=n.useState(()=>new l(s,t));n.useEffect(()=>{r.setOptions(t)},[r,t]);let a=n.useSyncExternalStore(n.useCallback(t=>r.subscribe(i.jG.batchCalls(t)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),c=n.useCallback((t,e)=>{r.mutate(t,e).catch(o.lQ)},[r]);if(a.error&&(0,o.GU)(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:c,mutateAsync:a.mutate}}},49380:(t,e,s)=>{"use strict";s.d(e,{A:()=>c,F:()=>u});var n=s(37876),r=s(14232),i=s(48230),a=s.n(i),o=s(18847);let l=s.n(o)()(()=>s.e(2287).then(s.bind(s,92287)),{loadableGenerated:{webpack:()=>[92287]},ssr:!1}),u=()=>{let[t,e]=(0,r.useState)(!1);return(0,n.jsxs)("nav",{className:"bg-white shadow-lg",children:[(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,n.jsxs)("div",{className:"flex justify-between h-16",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)(a(),{href:"/",className:"flex items-center",children:(0,n.jsx)("span",{className:"text-xl font-bold",children:"波打ち際の小瓶"})})}),(0,n.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,n.jsx)(a(),{href:"/",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"海を眺める"}),(0,n.jsx)(a(),{href:"/throw",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,n.jsx)(a(),{href:"/mybottles",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,n.jsx)(a(),{href:"/setting",className:"px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100",children:"設定"}),(0,n.jsx)(l,{})]}),(0,n.jsx)("div",{className:"md:hidden flex items-center",children:(0,n.jsxs)("button",{onClick:()=>e(!t),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:[(0,n.jsx)("span",{className:"sr-only",children:"メニューを開く"}),t?(0,n.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,n.jsx)("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]})})]})}),t&&(0,n.jsx)("div",{className:"md:hidden",children:(0,n.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[(0,n.jsx)(a(),{href:"/",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"海を眺める"}),(0,n.jsx)(a(),{href:"/throw",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"小瓶を流す"}),(0,n.jsx)(a(),{href:"/mybottles",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"拾った小瓶"}),(0,n.jsx)(a(),{href:"/setting",className:"block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100",children:"設定"}),(0,n.jsx)("div",{className:"px-3 py-2",children:(0,n.jsx)(l,{})})]})})]})},c=u},50477:()=>{},60573:(t,e,s)=>{"use strict";s.d(e,{L:()=>n,M:()=>r});let n="0xA01f4A6b456122e1e745d113e61aaBe1AbEfB422",r=[{inputs:[{internalType:"string",name:"uri",type:"string"}],name:"mintAndAssign",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"claim",outputs:[],stateMutability:"payable",type:"function"}]},73845:(t,e,s)=>{"use strict";s.d(e,{$:()=>y});var n,r=s(8106),i=s(4319),a=s(59688),o=s(30896),l=s.n(o);let u=(0,r.v)()((0,i.Zr)((t,e)=>({encryptedData:null,sessionApiKey:null,loadConfig:async(s,n)=>{let r=e().sessionApiKey;if(r)return{apiKey:r};try{let s=e().encryptedData;if(!s||s.address.toLowerCase()!==n.address.toLowerCase())return null;let r=l().SHA256(s.signature).toString(),i=l().AES.decrypt(s.ciphertext,r).toString(l().enc.Utf8);if(!i)return null;let a=JSON.parse(i);return t({sessionApiKey:a.apiKey}),a}catch(t){return console.error("設定の読み込みに失敗しました:",t),null}},encryptAndStoreConfig:async(e,s,n)=>{try{let r=JSON.stringify(e),i=await s.signMessage({account:n,message:"Encrypt filebase config"}),o=l().SHA256(i).toString(),u={ciphertext:l().AES.encrypt(r,o).toString(),signature:i,address:n.address};t({encryptedData:u,sessionApiKey:e.apiKey}),a.oR.success("設定を保存しました")}catch(t){throw console.error("設定の暗号化に失敗しました:",t),a.oR.error("設定の保存に失敗しました"),t}},clearConfig:()=>{t({encryptedData:null,sessionApiKey:null}),a.oR.success("設定を削除しました")}}),{name:"encrypted-filebase-storage",storage:(0,i.KU)(()=>localStorage),partialize:t=>({encryptedData:t.encryptedData,sessionApiKey:t.sessionApiKey})}));var c=s(91040);let d=null!=(n=s(65364).env.NEXT_PUBLIC_SUBGRAPH_URL)?n:"https://api.studio.thegraph.com/query/109981/ocean/version/latest";function h(t){return null==t?void 0:t.replace(/^ipfs:\/\//,"https://ipfs.io/ipfs/")}async function p(t){let e=h(t);if(!e)return{};try{let{name:t,description:s,message:n,image:r,animation_url:i}=(await c.A.get(e)).data;return{name:t,description:s,message:n,image:h(r),html:h(i)}}catch(t){return{}}}async function m(t){var e,s,n;let r=null!=(n=null==(s=(await c.A.post(d,{query:"{\n  driftingBottles {\n    id\n    tokenURI\n    sender\n  }\n}"})).data)||null==(e=s.data)?void 0:e.driftingBottles)?n:[];return t&&(r=r.filter(e=>{var s;return(null==(s=e.sender)?void 0:s.toLowerCase())!==t.toLowerCase()})),Promise.all(r.sort(()=>.5-Math.random()).slice(0,3).map(async t=>{var e;return{...t,metadata_url:h(t.tokenURI),...await p(null!=(e=t.tokenURI)?e:"")}}))}async function f(t){var e,s;let n='\n    query {\n      bottleClaimeds(where: { claimer: "'.concat(t.toLowerCase(),'" }) {\n        tokenId\n        blockTimestamp\n      }\n      bottleMinteds {\n        tokenId\n        tokenURI\n      }\n    }'),{bottleClaimeds:r,bottleMinteds:i}=null!=(s=null==(e=(await c.A.post(d,{query:n})).data)?void 0:e.data)?s:{bottleClaimeds:[],bottleMinteds:[]};return Promise.all(r.map(async t=>{let e=i.find(e=>e.tokenId===t.tokenId);if(!e)return null;let s=await p(e.tokenURI);return{id:t.tokenId,tokenId:t.tokenId,tokenURI:e.tokenURI,...s,date:new Date(1e3*parseInt(t.blockTimestamp)).toLocaleDateString("ja-JP"),status:"所有中",timestamp:new Date(1e3*parseInt(t.blockTimestamp)).toLocaleString("ja-JP")}})).then(t=>t.filter(t=>!!t))}let y=(0,r.v)()((0,i.Zr)((t,e)=>({bottles:[],userBottles:[],filebaseConfig:null,isLoading:!1,error:null,lastFetched:null,fetchBottles:async e=>{t({isLoading:!0,error:null});try{let s=await m(e);t({bottles:s,lastFetched:Date.now(),isLoading:!1})}catch(e){t({error:e,isLoading:!1})}},fetchUserBottles:async e=>{if(!e)return void t({error:Error("ウォレットが接続されていません")});t({isLoading:!0,error:null});try{let s=await f(e);t({userBottles:s,isLoading:!1})}catch(e){t({error:e,isLoading:!1})}},getBottleById:t=>e().bottles.find(e=>e.id===t),setConfig:e=>t({filebaseConfig:e}),loadConfig:async(e,s)=>{try{let n=await u.getState().loadConfig(e,s);t({filebaseConfig:n})}catch(e){t({filebaseConfig:null})}},saveConfig:async(e,s,n)=>{await u.getState().encryptAndStoreConfig(n,e,s),t({filebaseConfig:n})},clearConfig:()=>{u.getState().clearConfig(),t({filebaseConfig:null})}}),{name:"bottle-store"}))},88630:(t,e,s)=>{"use strict";s.d(e,{$:()=>r,T:()=>n});let n=(t,e,s)=>{t({...e,functionName:"mintAndAssign",args:[s]})},r=(t,e,s)=>{t({...e,functionName:"claim",args:[s]})}}}]);